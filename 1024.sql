--查詢語法
SELECT 
P.ID AS P_ID,
E.ID AS E_ID,
CITY.COMP_ID AS WITHHOLD_ID,                     --統編
 U.CODE AS EMP_ID,   --所得人證號
 DECODE(u.id,null,inu.IDENTITY_ID,u.IDENTITY_ID) as TAX_ID,
 DECODE(u.id,null,inu.NAME,u.name) as TAX_NAME,
  ACC.INCOME_FORM AS  INCOME_FORM ,             --所得格式
  ACC.INCOME_FORM AS SOURCE_KIND, --所得來源類別
 SUB.SUBPOENA_NO  AS PAY_CERT_NO, --付款憑單編號
 SUB.SUBPOENA_NO AS  SUBPOENA_NO , --傳票號碼
 SUB.SUBPOENA_DATE AS   SUBPOENA_DATE , --傳票日期
ACC.INCOME_BIZ AS TAXBIZ_CODE ,  --業別代號
G.GAIN_AMT AS CROSS_INCOME , --給付總額
 ACC.TAX_RATE AS TAX_RATE , --稅率
G.TAX_AMT2 AS WITHHOLDING_TAX , --稅額
 APPLD.CODE  AS COST_UNIT_CODE , --分錄成本單位代號
 APPLD.NAME AS COST_UNIT_NAME , --分錄成本單位中文
 '1' AS TEX_REMIT , --稅金匯回
 R.ROSTER_NO AS ROSTER_NO, --名冊單號
'GROUP_ID' AS GROUP_ID, --分錄群組ID
'TBEXP_ENTRY_TAX_ID'AS TBEXP_ENTRY_TAX_ID , --所得稅分錄
 ' F225942034' AS CREATE_USER_ID  ,--建檔人員
'2011-06-13' AS CREATE_DATE , --建檔日
 '1' AS VERSION_NO   --版本
FROM TBEXP_EXPAPPL_B B
INNER JOIN TBEXP_PROOF P ON P.TBEXP_EXPAPPL_B_ID=B.ID
INNER JOIN TBEXP_PROOF_ENTRY_R ER ON ER.TBEXP_PROOF_ID=P.ID
INNER JOIN TBEXP_ENTRY E ON E.ID=ER.TBEXP_ENTRY_ID
INNER JOIN TBEXP_ROSTER_DETAIL R ON R.ID=P.TBEXP_ROSTER_DETAIL_ID
INNER JOIN TBEXP_ACC_TITLE ACC ON ACC.ID=R.TBEXP_ACC_TITLE_ID
INNER JOIN TBEXP_USER APPL ON APPL.ID=B.TBEXP_APPL_USER_ID
INNER JOIN TBEXP_DEPARTMENT APPLD ON APPLD.ID=APPL.TBEXP_DEPARTMENT_ID
INNER JOIN TBEXP_AREA AREA ON AREA.ZIP = APPLD.ZIP
INNER JOIN TBEXP_CITY CITY ON CITY.ID  = AREA.TBEXP_CITY_ID
INNER JOIN TBEXP_GAIN_PERSON G ON G.TBEXP_ROSTER_DETAIL_ID=R.ID
left JOIN TBEXP_USER U ON U.CODE=G.GAIN_USER_ID
left join tbexp_income_user　inu on inu.id=g.tbexp_income_user_id
INNER JOIN TBEXP_SUBPOENA SUB ON SUB.ID=B.TBEXP_SUBPOENA_ID
where r.roster_no='AD5000120140515001';

---
AMP000520170921003 $4,940(所得來源類別：G3)
S006A11001 AMP000

AG3000220170929003 $31,998(所得來源類別：G3)
S006A13001 AG3000

AG3000120170919001 $20,000(所得來源類別：G2)
AG3000120170925001 $8,000(所得來源類別：G2)
S006A13001 AG3000


--alter session set current_schema=expadmin;
--ACB000220170828001
--新增語法
Insert into EXPADMIN.TBEXP_TAX_DETAIL
   (ID, WITHHOLD_ID, EMP_ID, TAX_ID, TAX_NAME, INCOME_FORM, SOURCE_KIND, PAY_CERT_NO,SUBPOENA_NO, SUBPOENA_DATE, TAXBIZ_CODE, CROSS_INCOME, TAX_RATE, WITHHOLDING_TAX, COST_UNIT_CODE, COST_UNIT_NAME, TEX_REMIT,ROSTER_NO, GROUP_ID, TBEXP_ENTRY_TAX_ID, CREATE_USER_ID, CREATE_DATE, VERSION_NO  )
    Values
   ('201709-00000000-000S0069040010000001', '52253119', '', 'L224891149', '陳鈺婷', '91','91', 'S006904001','S006904001', TO_DATE('2017-09-04','YYYY-MM-DD'), '', '4725', '0.1', '0', 'ACB000', '潭子通－收', '1','ACB000220170828001', 'IMP00000-0000-0000-S0069040010000001', '', 'F225942034', TO_DATE('2011-06-13','YYYY-MM-DD'), '1');
                       
   
INSERT INTO TBEXP_PROOF_TAX_DETAIL_R (TBEXP_TAX_DETAIL_ID,TBEXP_PROOF_ID)
Values('201709-00000000-000S0069040010000001','F1F6FC41-53B3-4EC8-8D8D-1673CEDCDA1C');

INSERT INTO TBEXP_ENTRY_EXP_GROUP(ID, GROUP_ID,TBEXP_ENTRY_ID)
VALUES ('IMP00920-0000-0000-S0069040010000001','IMP00000-0000-0000-S0069040010000001','26B3B9D6-5823-4947-BD04-8E9F18D877D5');

--新增語法--ACB000220170828002
Insert into EXPADMIN.TBEXP_TAX_DETAIL
   (ID, WITHHOLD_ID, EMP_ID, TAX_ID, TAX_NAME, INCOME_FORM, SOURCE_KIND, PAY_CERT_NO,SUBPOENA_NO, SUBPOENA_DATE, TAXBIZ_CODE, CROSS_INCOME, TAX_RATE, WITHHOLDING_TAX, COST_UNIT_CODE, COST_UNIT_NAME, TEX_REMIT,ROSTER_NO, GROUP_ID, TBEXP_ENTRY_TAX_ID, CREATE_USER_ID, CREATE_DATE, VERSION_NO  )
    Values
   ('201709-00000000-000S0069040010000002','52253119','','L224891149','陳鈺婷', '91','91', 'S006904001','S006904001', TO_DATE('2017-09-04','YYYY-MM-DD'), '', '3280', '0.1', '0', 'ACB000', '潭子通－收', '1','ACB000220170828002', 'IMP00000-0000-0000-S0069040010000002', '', 'F225942034', TO_DATE('2011-06-13','YYYY-MM-DD'), '1');
                       
   
INSERT INTO TBEXP_PROOF_TAX_DETAIL_R (TBEXP_TAX_DETAIL_ID,TBEXP_PROOF_ID)
Values('201709-00000000-000S0069040010000002','296EEA65-77C8-439E-9267-40338C8264B9');

INSERT INTO TBEXP_ENTRY_EXP_GROUP(ID, GROUP_ID,TBEXP_ENTRY_ID)
VALUES ('IMP00920-0000-0000-S0069040010000002','IMP00000-0000-0000-S0069040010000002','D0E25F66-5507-4181-B344-B5840ED47876');
