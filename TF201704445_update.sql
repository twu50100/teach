--alter session set current_schema=expadmin;

--5723
delete
from tbexp_user_function_r where tbexp_user_id in(select u.id
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000250'
)) and tbexp_function_id IN (
'C0156000-0000-0000-0000-000000000000',
'C0164000-0000-0000-0000-000000000000',
'C0167000-0000-0000-0000-000000000000',
'C0160000-0010-0000-0000-000000000000'
);
--10576
insert into tbexp_user_function_r(tbexp_user_id,tbexp_function_id)
select u.id,'C0156000-0000-0000-0000-000000000000'
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
select u.id,'C0164000-0000-0000-0000-000000000000'
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
select u.id,'C0167000-0000-0000-0000-000000000000'
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
select u.id,'C0160000-0010-0000-0000-000000000000'
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000250')
;
--29
DELETE FROM TBEXP_FUNCTION_GROUP_R WHERE TBEXP_GROUP_ID IN (
SELECT TBEXP_GROUP_ID
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000006',
'S00GROUP-0001-0000-0000-000000000007',
'S00GROUP-0001-0000-0000-000000000008',
'S00GROUP-0001-0000-0000-000000000009',
'S00GROUP-0001-0000-0000-000000000250')
) AND TBEXP_FUNCTION_ID IN (
'C0156000-0000-0000-0000-000000000000',
'C0164000-0000-0000-0000-000000000000',
'C0167000-0000-0000-0000-000000000000',
'C0160000-0010-0000-0000-000000000000'
);

--44
insert into  TBEXP_FUNCTION_GROUP_R 
SELECT DISTINCT 'C0156000-0000-0000-0000-000000000000',TBEXP_GROUP_ID
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000006',
'S00GROUP-0001-0000-0000-000000000007',
'S00GROUP-0001-0000-0000-000000000008',
'S00GROUP-0001-0000-0000-000000000009',
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
SELECT DISTINCT 'C0164000-0000-0000-0000-000000000000',TBEXP_GROUP_ID
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000006',
'S00GROUP-0001-0000-0000-000000000007',
'S00GROUP-0001-0000-0000-000000000008',
'S00GROUP-0001-0000-0000-000000000009',
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
SELECT DISTINCT 'C0167000-0000-0000-0000-000000000000',TBEXP_GROUP_ID
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000006',
'S00GROUP-0001-0000-0000-000000000007',
'S00GROUP-0001-0000-0000-000000000008',
'S00GROUP-0001-0000-0000-000000000009',
'S00GROUP-0001-0000-0000-000000000250')
UNION ALL 
SELECT DISTINCT 'C0160000-0010-0000-0000-000000000000',TBEXP_GROUP_ID
from tbexp_user u
inner join tbexp_department d on d.id=u.tbexp_department_id
LEFT JOIN tbexp_department d2 on d.tbexp_department_id=D2.ID
where (d.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000') OR d2.code in('111000','11N000','11Z000','13Z000','12Z000','1VX000','11U000','11D000','11M000','11W000','11X000','107000','117000'
,'114000','119000','11P000','11R000','11F000','18A000','105000','116000','103000','11B000','11K000','11Y000','109000','11E000','11Q000'
,'117900','12C000','12A000','15A000')) AND TBEXP_GROUP_ID NOT IN (
'S00GROUP-0001-0000-0000-000000000006',
'S00GROUP-0001-0000-0000-000000000007',
'S00GROUP-0001-0000-0000-000000000008',
'S00GROUP-0001-0000-0000-000000000009',
'S00GROUP-0001-0000-0000-000000000250')
;
